{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte Granja | AlgasBio</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#e65100">

    <style>
        body { background-color: #fff3e0; font-family: 'Segoe UI', sans-serif; }
        .card-custom { border: none; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .header-bg { background: linear-gradient(135deg, #e65100, #ff9800); color: white; border-radius: 15px 15px 0 0; padding: 20px; }
        
        #status-bar { padding: 10px; margin-bottom: 15px; border-radius: 8px; font-weight: bold; text-align: center; display: none; }
        .online { background-color: #d1e7dd; color: #0f5132; border: 1px solid #badbcc; }
        .offline { background-color: #f8d7da; color: #842029; border: 1px solid #f5c2c7; }

        .btn-submit { background-color: #ef6c00; border: none; padding: 12px; font-size: 1.1rem; font-weight: 600; }
        .btn-submit:hover { background-color: #e65100; }
    </style>
</head>
<body class="py-4">

    <div class="container" style="max-width: 500px;">
        
        <div class="card card-custom">
            <div class="header-bg text-center">
                <h3 class="mb-0"><i class="fa-solid fa-kiwi-bird"></i> Granja Aves</h3>
                <small>Control Diario de Huevos y Alimento</small>
            </div>
            
            <div class="card-body p-4">
                
                <div id="status-bar"></div>

                <form id="form-granja">
                    
                    <div class="form-floating mb-3">
                        <select class="form-select" id="lote" required>
                            <option value="" selected disabled>Seleccione Lote</option>
                            {% for lote in lotes %}
                                <option value="{{ lote.id }}">{{ lote.nombre }} ({{ lote.get_tipo_dieta_display }})</option>
                            {% endfor %}
                        </select>
                        <label for="lote"><i class="fa-solid fa-layer-group"></i> Lote de Aves</label>
                    </div>

                    <div class="form-floating mb-3">
                        <input type="number" class="form-control" id="huevos" placeholder="0" required>
                        <label for="huevos"><i class="fa-solid fa-egg"></i> Huevos Recolectados</label>
                    </div>

                    <div class="form-floating mb-3">
                        <input type="number" step="0.01" class="form-control" id="alimento" placeholder="0.00" required>
                        <label for="alimento"><i class="fa-solid fa-wheat-awn"></i> Alimento Consumido (Kg)</label>
                    </div>

                    <div class="form-floating mb-3">
                        <input type="number" class="form-control" id="mortalidad" value="0">
                        <label for="mortalidad"><i class="fa-solid fa-skull-crossbones"></i> Mortalidad (Opcional)</label>
                    </div>

                    <div class="form-floating mb-4">
                        <input type="text" class="form-control" id="responsable" placeholder="Nombre" required>
                        <label for="responsable"><i class="fa-regular fa-id-card"></i> Nombre del Trabajador</label>
                    </div>

                    <button type="submit" class="btn btn-primary btn-submit w-100 shadow-sm">
                        <i class="fa-solid fa-check-circle"></i> Guardar Registro
                    </button>

                </form>
            </div>
            <div class="card-footer text-center bg-white border-0 pb-3">
                <a href="/" class="text-decoration-none text-muted small">
                    <i class="fa-solid fa-arrow-left"></i> Volver al Dashboard
                </a>
            </div>
        </div>
    </div>

    <script src="{% static 'js/app.js' %}"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // CAMBIO IMPORTANTE: Quitamos {% static ... %} y ponemos la ruta directa
                navigator.serviceWorker.register("/sw.js")
                    .then(reg => console.log('SW registrado en la raÃ­z! ðŸ˜Ž', reg.scope))
                    .catch(err => console.log('Fallo SW:', err));
            });
        }
    </script>
</body>
</html>